@import uk.gov.hmrc.awrslookup._
@import uk.gov.hmrc.play.views.html.helpers._
@import views.html.helpers._
@import models._
@import common._
@import search._
@import results._

@(searchForm : Form[models.Query], action: Call, searchTerm: Option[String] = None, searchResult: Option[SearchResult] = None)(implicit request : Request[AnyContent], messages: Messages)

@searchTitle = @{
    (searchTerm, searchResult) match {
        case (Some(_), (None | Some(SearchResult(Nil))))            => Messages("awrs.lookup.results.page_title_no_results")
        case (_ , (Some(SearchResult(list)))) if list.size > 1      => Messages("awrs.lookup.results.heading_multi_results", searchTerm.get)
        case _ => Messages("awrs.lookup.search.page_title")
    }
}

@resultCounter(size: Int) = {
    <p id="result-count">@Messages("awrs.lookup.results.results_found", size)</p>
}

@multiResults(results: List[AwrsEntry]) = {
    <h1 class="heading-medium" id="search-heading">@Messages("awrs.lookup.results.heading_multi_results", results.size, searchTerm.get)</h1>
    <div id = "search-results">
        @results.zipWithIndex.map {
            case (result, ind) => {
                @awrs_entry_compact(result, ind.toString, searchTerm.fold("")(x => x))
            }
        }
    </div>
}

@results = {
    @searchResult match {
        case Some(SearchResult(results)) if results.size > 1 => { @multiResults(results) }
        case _ => {}
    }
}

@headers = {
    @(searchTerm, searchResult)match {
        case (Some(_), _) | (_, Some(_)) => {}
        case _ => {
            <h1 class="heading-xlarge" id="search-heading">@Messages("awrs.lookup.search.heading")</h1>
            <p class="lede" id="search-lede">@Html(Messages("awrs.lookup.search.lede", awrs_urn(), isle_of_man_link()))</p>
        }
    }
}

@searchbar = {
<div class="search">
    @awrsInputTypeText(
    field = searchForm("query"),
    inputClass = "search-awrs",
    parentForm = searchForm,
    maxLength = 140,
    postInputContent = search_button(id = "search", classAttr = None),
    label = Messages("awrs.lookup.search.label"),
    labelClass = "visuallyhidden"
    )
</div>
}

@cssScripts = {
<link rel="stylesheet" href=@routes.Assets.at("stylesheets/custom.css")>
}

@pageScripts = {<script type="text/javascript" src='@routes.Assets.at("javascripts/awrs.js")'></script>}

@views.html.main_template(title = searchTitle, bodyClasses = None, contentHeader = cssScripts, scriptElem = pageScripts) {
    @helper.form(action = action) {
        @searchbar
    }
    <div class="grid">
        <div class="grid-2-3">
            @headers
            @*  This uses the play's default form helper which does not include the hidden CSRF token field.
            This is because currently this service is completely sessionless and stateless thus
            does not require CSRF protection, and we do not want it to appear in the query String.
            *@
            @results
        </div>
    </div>
}
