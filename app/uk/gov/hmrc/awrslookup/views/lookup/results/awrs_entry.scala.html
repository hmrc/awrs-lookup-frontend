@import uk.gov.hmrc.awrslookup._
@import uk.gov.hmrc.awrslookup.models._
@import uk.gov.hmrc.play.views.html.helpers._
@import views.html._
@import helpers._
@import lookup.common._
@import lookup.results._
@import collection.immutable.ListMap
@import utils.AwrsDateFormatter

@(
    result: AwrsEntry,
    id: String,
    searchTerm: String,
    fromMulti: Boolean = false,
    originalSearchTerm: Option[String] = None,
    mainHeading: Html
)(implicit
    request : Request[AnyContent],
    messages: Messages
)

@tableHeadingMedium(name: String, heading: String, additionalClasses: Option[String] = "group-section") = {
    <h2 class="heading-large  no-bottom-border" id="@{name}_heading">@heading</h2>
}

@tableHeadingSmall(name: String, heading: String, additionalClasses: Option[String] = "member-section") = {
    <h3 class="heading-small @additionalClasses" id="@{name}_heading">@heading</h3>
}

@common(showRegNumber: Boolean) = {
    @showRegNumber match {
        case true => {
                <div class="grid grid-1-2">
                    <h2 class="heading-small">@Messages("awrs.lookup.results.reg_number")</h2>
                    <p>@result.awrsRefFormatted</p>
                </div>
}
        case false => {}
    }

<div class="grid grid-1-2">
    <h2 class="heading-small">@Messages("awrs.lookup.results.status_label")</h2>
    <p>@result.status.map(_.name)</p>
</div>
<div class="grid grid-1-2">
    <h2 class="heading-small">@Messages("awrs.lookup.results.date_of_reg")</h2>
    <p>@result.registrationDateFormatted</p>
</div>


    @result.status match {
        case AwrsStatus.DeRegistered | AwrsStatus.Revoked => {
        <div class="grid grid-1-2">
            <h2 class="heading-small">@Messages("awrs.lookup.results.date_of_dereg")</h2>
            <p>@result.registrationEndDateFormatted</p>
        </div>

        }
        case _ =>{}
    }
}

@address(someAddress: Option[Address], id: String) = {
    @someAddress match {
        case Some(address) => {
                <div class="grid grid-1-2">
                    <h2 class="heading-small">@Messages("awrs.lookup.results.principle_place_Business")</h2>
                    <p>@address.addressLine1<br>@address.addressLine2<br>@address.addressLine3<br>@address.addressLine4<br>@address.postcode<br>@address.addressCountry</p>
                </div>
        }
        case _ => {}
    }
}

@memberStatus(id: String = id) = {
    <tr id="@{id}_status">
        <th id="@{id}_status_label" class="result_label">@Messages("awrs.lookup.results.status_label")</th>
        <td id="@{id}_status_detail">
        @result.status match {
            case AwrsStatus.DeRegistered => {
                @Messages("awrs.generic.status.deregistered")
            }
            case AwrsStatus.Revoked => {
                @Messages("awrs.generic.status.revoked")
            }
            case _ => {
                @Messages("awrs.generic.status.approved_group_member")
            }
        }
        </td>
    </tr>
}

@info(info: Info, id: String = id) = {

    <div class="grid grid-1-2">
        <h2 class="heading-small">@Messages("awrs.lookup.results.business_name")</h2>
        <p>@info.businessName</p>
    </div>

    @address(info.address, id)
}

@business(business: Business) = {
    <h1 class="heading-xlarge" id="results-heading">
        @mainHeading
    </h1>
    @headerRegNumberHighlight(result)
    @status_warning(result)
    <table id="results-table" role="presentation">
        @common(showRegNumber = true)
        @info(business.info)
    </table>
}

@group(group: Group) = {



<div class="grid">
    <div class="grid-row">
        <h1 class="heading-xlarge" id="results-heading">
            @mainHeading
        </h1>
        @headerRegNumberHighlight(result)

     @status_warning(result)

    @tableHeadingMedium(id+"_representative", Messages("awrs.lookup.results.group_rep_table_heading"), additionalClasses = None)

        @common(showRegNumber = true)
        @info(group.info)
</div>
</div>

    @tableHeadingMedium(id+"_members", Messages("awrs.lookup.results.group_member_table_heading"))
    @group.members.zipWithIndex.map {
        case (memberInfo: Info, index: Int) => {
            @tableHeadingSmall(s"${id}_member_$index", knownName(memberInfo))
            <table id="results-table-@{index}" role="presentation">
                @memberStatus(id = s"${id}_member_$index")
                @info(memberInfo, id = s"${id}_member_$index")
            </table>
        }
    }
}

@result match {
    case  bus : Business => { @business(bus) }
    case  grp : Group    => { @group(grp) }
}
